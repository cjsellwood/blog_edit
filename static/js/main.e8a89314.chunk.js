(this.webpackJsonpblog_edit=this.webpackJsonpblog_edit||[]).push([[0],{26:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),i=n(20),a=n.n(i),o=(n(26),n(9)),r=n(15),l=n(2),d=n(10),u=(n(27),n(3)),j=n(8),h=(n(28),n(0)),b=function(e){var t=Object(u.h)().id,n=e.posts.filter((function(e){return e._id===t}))[0],c=null;return"undefined"!==typeof n.title&&(c=n.comments.map((function(n){return Object(h.jsxs)("li",{children:[Object(h.jsx)("p",{children:n.username}),Object(h.jsx)("p",{className:"date",children:new Date(n.date).toLocaleDateString()}),Object(h.jsx)("p",{className:"comment-text",children:n.text}),Object(h.jsx)("button",{onClick:function(c){return e.deleteComment(t,n._id,c)},children:"Delete"})]},n._id)}))),Object(h.jsxs)("div",{className:"Post",children:[Object(h.jsx)("h1",{className:"title",children:n.title}),Object(h.jsx)("p",{className:"date",children:new Date(n.date).toLocaleDateString()}),Object(h.jsx)("p",{children:n.text}),Object(h.jsxs)("div",{className:"update-buttons",children:[Object(h.jsx)(j.b,{to:"/".concat(n._id,"/edit"),children:"Edit"}),Object(h.jsx)("button",{onClick:e.deletePost,"data-id":n._id,children:"Delete"})]}),Object(h.jsx)("h2",{className:"comment-title",children:"Comments"}),Object(h.jsx)("ol",{className:"comment-list",children:c}),Object(h.jsxs)("form",{onSubmit:e.addComment,method:"POST","data-id":t,className:"form",children:[Object(h.jsx)("h3",{children:"Add Comment"}),Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"username",children:"Username"}),Object(h.jsx)("input",{onChange:e.handleInput,type:"text",name:"username",placeholder:"username",id:"username",value:e.comment.username,required:!0})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"text",children:"Comment"}),Object(h.jsx)("textarea",{onChange:e.handleInput,id:"text",name:"text",placeholder:"Comment",value:e.comment.text,required:!0,rows:"5"})]}),Object(h.jsx)("button",{type:"submit",children:"Submit"})]})]})},m=(n(38),function(e){return Object(h.jsxs)("div",{className:"NewForm",children:[Object(h.jsx)("h1",{className:"title",children:"New Blog Post"}),Object(h.jsxs)("form",{className:"form",onSubmit:e.newPost,children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"title",children:"Title"}),Object(h.jsx)("input",{type:"text",placeholder:"Title",name:"title",id:"title",onChange:e.handlePostInput,value:e.postForm.title,required:!0})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"text",children:"Content"}),Object(h.jsx)("textarea",{placeholder:"Content",name:"text",id:"text",rows:"20",onChange:e.handlePostInput,value:e.postForm.text,required:!0})]}),Object(h.jsxs)("div",{className:"radio",children:[Object(h.jsx)("p",{children:"Publish Now?"}),Object(h.jsx)("input",{type:"radio",id:"publish",name:"published",value:"true",onChange:e.handlePostInput,checked:e.postForm.published}),Object(h.jsx)("label",{htmlFor:"publish",children:"Yes"}),Object(h.jsx)("br",{}),Object(h.jsx)("input",{type:"radio",id:"unpublish",name:"published",value:"false",onChange:e.handlePostInput,checked:!e.postForm.published}),Object(h.jsx)("label",{htmlFor:"unpublish",children:"No"})]}),Object(h.jsx)("button",{children:"Submit"})]})]})}),p=function(e){var t=Object(u.h)().id;return Object(c.useEffect)((function(){e.startEditing(t)}),[]),Object(h.jsxs)("div",{className:"NewForm",children:[Object(h.jsx)("h1",{className:"title",children:"Edit Blog Post"}),Object(h.jsxs)("form",{className:"form",onSubmit:e.handleEditSubmit,"data-id":t,children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"title",children:"Title"}),Object(h.jsx)("input",{type:"text",placeholder:"Title",name:"title",id:"title",onChange:e.handleEditInput,value:e.editPost.title})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"text",children:"Content"}),Object(h.jsx)("textarea",{placeholder:"Content",name:"text",id:"text",rows:"20",onChange:e.handleEditInput,value:e.editPost.text})]}),Object(h.jsxs)("div",{className:"radio",children:[Object(h.jsx)("p",{children:"Publish Now?"}),Object(h.jsx)("input",{type:"radio",id:"publish",name:"published",value:"true",onChange:e.handleEditInput,checked:e.editPost.published}),Object(h.jsx)("label",{htmlFor:"publish",children:"Yes"}),Object(h.jsx)("br",{}),Object(h.jsx)("input",{type:"radio",id:"unpublish",name:"published",value:"false",onChange:e.handleEditInput,checked:!e.editPost.published}),Object(h.jsx)("label",{htmlFor:"unpublish",children:"No"})]}),Object(h.jsx)("button",{children:"Submit"})]})]})},O=function(e){return Object(h.jsxs)("div",{children:[Object(h.jsx)("h1",{className:"title",children:"Login"}),Object(h.jsxs)("form",{onSubmit:e.login,className:"form",children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"username",children:"Username"}),Object(h.jsx)("input",{type:"text",name:"username",id:"username",onChange:e.loginFormInput,value:e.loginForm.username})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("label",{htmlFor:"password",children:"Password"}),Object(h.jsx)("input",{type:"password",name:"password",id:"password",onChange:e.loginFormInput,value:e.loginForm.password})]}),Object(h.jsx)("button",{type:"submit",children:"Login"})]})]})},x=function(e){return Object(h.jsx)(s.a.Fragment,{children:e.auth.loggedIn?e.children:Object(h.jsx)(u.a,{to:"/login"})})},f=(n(39),function(){return Object(h.jsx)("div",{className:"loader-wrapper",children:Object(h.jsx)("div",{className:"loader",children:"Loading"})})}),g=function(){var e=Object(c.useState)([]),t=Object(d.a)(e,2),n=t[0],s=t[1],i=Object(c.useState)(!0),a=Object(d.a)(i,2),g=a[0],v=a[1],N=Object(u.g)(),w="https://desolate-sands-05653.herokuapp.com",S=function(e){return e.map((function(e){return Object(l.a)(Object(l.a)({},e),{},{comments:Object(r.a)(e.comments)})}))};Object(c.useEffect)((function(){fetch("".concat(w,"/posts/all"),{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){s(e),v(!1)}))}),[]);var C=function(e){e.preventDefault();var t,c=e.target.getAttribute("data-id"),i=n.filter((function(e,n){return e._id===c&&(t=n),e._id===c}))[0],a={method:"PATCH",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Y.token)},body:JSON.stringify({id:c,published:i.published})};fetch("".concat(w,"/posts/").concat(c,"/publish"),a).then((function(e){if(401===e.status)throw new Error("Unauthorized");return e.json()})).then((function(e){if("Success"===e.status){var c=S(n);c.splice(t,1,e.post),s(c)}})).catch((function(e){"Unauthorized"===e.message&&N.push("/login")}))},y=[];n.length&&(y=n.map((function(e){return Object(h.jsx)("li",{className:"post",children:Object(h.jsxs)(j.b,{to:"/".concat(e._id),children:[Object(h.jsx)("h1",{children:e.title}),Object(h.jsx)("p",{className:"date",children:new Date(e.date).toLocaleDateString()}),e.published?Object(h.jsxs)("div",{className:"published",children:[Object(h.jsx)("p",{children:"Status: Published"}),Object(h.jsx)("button",{onClick:C,"data-id":e._id,children:"Change"})]}):Object(h.jsxs)("div",{className:"published",children:[Object(h.jsx)("p",{children:"Status: Unpublished"}),Object(h.jsx)("button",{onClick:C,"data-id":e._id,children:"Change"})]})]})},e._id)})));var P=Object(c.useState)({username:"",text:""}),E=Object(d.a)(P,2),F=E[0],I=E[1],_=Object(c.useState)({title:"",text:"",published:!1}),k=Object(d.a)(_,2),T=k[0],D=k[1],z=Object(c.useState)({title:"",text:"",published:!1}),A=Object(d.a)(z,2),U=A[0],B=A[1],J=Object(c.useState)({username:"",password:""}),L=Object(d.a)(J,2),q=L[0],R=L[1],H=Object(c.useState)({}),M=Object(d.a)(H,2),Y=M[0],G=M[1];return Object(c.useEffect)((function(){!function(){var e=localStorage.getItem("token"),t=localStorage.getItem("expires");Date.now()<Number(t)&&G({token:e,loggedIn:!0})}()}),[]),g?Object(h.jsx)(f,{}):Object(h.jsx)("div",{className:"App",children:Object(h.jsxs)(u.d,{children:[Object(h.jsx)(u.b,{path:"/login",children:Object(h.jsx)(O,{login:function(e){e.preventDefault(),console.log(q);var t={method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)};fetch("${baseUrl}/posts/login",t).then((function(e){return e.json()})).then((function(e){"Auth Passed"===e.message&&(G(Object(l.a)(Object(l.a)({},Y),{},{token:e.token,loggedIn:!0,expires:e.expires})),localStorage.setItem("token",e.token),localStorage.setItem("expires",Date.now()+1e3*e.expires),R({username:"",password:""}),N.push("/"))})).catch((function(e){console.log("ERROR",e)}))},loginForm:q,loginFormInput:function(e){R(Object(l.a)(Object(l.a)({},q),{},Object(o.a)({},e.target.name,e.target.value)))}})}),Object(h.jsx)(u.b,{path:"/new",children:Object(h.jsx)(x,{auth:Y,children:Object(h.jsx)(m,{newPost:function(e){e.preventDefault(),console.log(T),v(!0);var t={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Y.token)},body:JSON.stringify(T)};fetch("".concat(w,"/posts"),t).then((function(e){if(401===e.status)throw new Error("Unauthorized");return e.json()})).then((function(e){if("Success"===e.status){var t=S(n);s([].concat(Object(r.a)(t),[e.newPost])),N.push("/"),D({title:"",text:"",published:!1}),v(!1)}})).catch((function(e){v(!1),"Unauthorized"===e.message&&N.push("/login")}))},handlePostInput:function(e){"published"===e.target.name?D(Object(l.a)(Object(l.a)({},T),{},Object(o.a)({},e.target.name,"true"===e.target.value))):D(Object(l.a)(Object(l.a)({},T),{},Object(o.a)({},e.target.name,e.target.value)))},postForm:T})})}),Object(h.jsx)(u.b,{path:"/:id/edit",children:Object(h.jsx)(x,{auth:Y,children:Object(h.jsx)(p,{postForm:T,posts:n,startEditing:function(e){var t=n.filter((function(t){return t._id===e}))[0];B({title:t.title,text:t.text,published:t.published})},handleEditInput:function(e){"published"===e.target.name?B(Object(l.a)(Object(l.a)({},U),{},Object(o.a)({},e.target.name,"true"===e.target.value))):B(Object(l.a)(Object(l.a)({},U),{},Object(o.a)({},e.target.name,e.target.value)))},editPost:U,handleEditSubmit:function(e){var t,c=e.target.getAttribute("data-id");v(!0);n.filter((function(e,n){return e._id===c&&(t=n),e._id===c}))[0];e.preventDefault(),console.log(U);var i={method:"PATCH",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Y.token)},body:JSON.stringify(Object(l.a)({id:c},U))};fetch("".concat(w,"/posts/").concat(c),i).then((function(e){if(401===e.status)throw new Error("Unauthorized");return e.json()})).then((function(e){N.push("/".concat(c));var i=S(n);i.splice(t,1,e.editedPost),s(i),v(!1)})).catch((function(e){v(!1),"Unauthorized"===e.message&&N.push("/login")}))}})})}),Object(h.jsx)(u.b,{path:"/:id",children:Object(h.jsx)(x,{auth:Y,children:Object(h.jsx)(b,{posts:n,addComment:function(e){e.preventDefault();var t=e.target.getAttribute("data-id"),c={method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)};fetch("".concat(w,"/posts/").concat(t,"/comment"),c).then((function(e){return e.json()})).then((function(e){var c,i=n.filter((function(e,n){return e._id===t&&(c=n),e._id===t}))[0];if("Success"===e.status){var a=S(n);a.splice(c,1,Object(l.a)(Object(l.a)({},i),{},{comments:[].concat(Object(r.a)(i.comments),[Object(l.a)(Object(l.a)({},e.comment),{},{date:Date.now()})])})),s(a),I({username:"",text:""})}}))},handleInput:function(e){I(Object(l.a)(Object(l.a)({},F),{},Object(o.a)({},e.target.name,e.target.value)))},comment:F,deletePost:function(e){var t,c=e.target.getAttribute("data-id");v(!0);n.filter((function(e,n){return e._id===c&&(t=n),e._id===c}))[0];var i={method:"DELETE",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Y.token)},body:JSON.stringify({id:c})};fetch("".concat(w,"/posts/").concat(c),i).then((function(e){if(401===e.status)throw new Error("Unauthorized");return e.json()})).then((function(e){if("Success"===e.status){var c=S(n);c.splice(t,1),N.replace("/"),s(c),v(!1)}})).catch((function(e){v(!1),"Unauthorized"===e.message&&N.push("/login")}))},deleteComment:function(e,t){var c,i=n.filter((function(t,n){return t._id===e&&(c=n),t._id===e}))[0],a={method:"DELETE",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(Y.token)}};fetch("".concat(w,"/posts/").concat(e,"/comment/").concat(t),a).then((function(e){if(401===e.status)throw new Error("Unauthorized");return e.json()})).then((function(e){if("Success"===e.status){var a=S(n),o=i.comments.filter((function(e){return e._id!==t}));a[c].comments=o,s(a)}})).catch((function(e){"Unauthorized"===e.message&&N.push("/login")}))}})})}),Object(h.jsx)(u.b,{exact:!0,path:"/",children:Object(h.jsxs)(x,{auth:Y,children:[Object(h.jsxs)("div",{className:"title",children:[Object(h.jsx)("h1",{children:"My Blog Posts"}),Object(h.jsx)(j.b,{to:"/new",children:"New Post"})]}),Object(h.jsx)("ul",{children:y})]})})]})})};a.a.render(Object(h.jsx)(s.a.StrictMode,{children:Object(h.jsx)(j.a,{children:Object(h.jsx)(g,{})})}),document.getElementById("root"))}},[[40,1,2]]]);
//# sourceMappingURL=main.e8a89314.chunk.js.map